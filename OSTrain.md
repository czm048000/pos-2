# “测测你的GPA”：实时操作系统调度算法评估框架的设计与实现

本项目为操作系统专题训练的项目仓库。

- [“测测你的GPA”：实时操作系统调度算法评估框架的设计与实现](#测测你的gpa实时操作系统调度算法评估框架的设计与实现)
  - [Motivation](#motivation)
  - [系统定义与设计](#系统定义与设计)
    - [写作业模型](#写作业模型)
    - [调度算法评估框架](#调度算法评估框架)
  - [现有的研究](#现有的研究)
  - [项目任务与难点](#项目任务与难点)

## Motivation

在遥远的青蛤大学，有一个倒霉的小陈同学，她为了毕业必须选很多个学分的课，而且每门课都不能挂科，否则就会毕不了业、失去推研资格，后果十分悲惨。然而课程太多、作业太多，小陈无法把每份作业都完美地完成，只好对每份作业都只完成一部分，以保证自己不能挂科。于是她希望能采取某种写作业调度策略，使得每门课都不挂科，且课程GPA要尽可能地高。

## 系统定义与设计

我们发现，这个“写作业调度策略”可以实现为一个游戏，下面我们来对这个游戏进行定义。

### 写作业模型

我们将完成作业的过程进行抽象。

每一个作业具备2个玩家已知的属性：score和ddl，完成作业的最后得分$final=score*(grade>=passline?grade:0)$

- score：是“学分数”，score越高意味着这个作业越重要
- ddl：是一个时间，必须在这个时间之前完成的作业才能计算为完成度，ddl之后完成的作业不会算分
- grade：作业的完成度，即：ddl之前作业完成了多少。具体评估方式[见下文](#项目任务与难点)
- passline：及格线，满分为100，只有ddl之前的完成度达到（指大于等于）及格线时，才能得到对应分数，否则得到的分数为0。在我们的游戏中，passline统一设置为60

每位同学的GPA=$\frac{\sum final}{\sum score}$。

“一个学期”是一轮游戏，有固定的总时间，时间到则游戏结束，开始计算GPA。

​游戏开始时，只有0个作业。在游戏的任意一个时刻，都可以产生一份新的作业。作业可以分阶段完成，且可以在任意一个阶段停止，去完成另一个作业。小陈（游戏玩家）需要做的事情是：实现一个写作业调度方案，以此决定写作业顺序，使得最终获得的GPA尽可能地高。

### 调度算法评估框架

此游戏可以实现为一个实时操作系统调度算法的评估框架。

具体地说，每一个作业都作为一个进程出现，用来评估特定的进程调度算法。每个进程都有一个规定的完成时间，因此这是一个实时操作系统。

## 现有的研究

现有的对实时操作系统的性能评估模型，集中于对操作系统整体进行性能评估。例如：
>RhealStone提供了6个关键操作的时间量。它们是任务切换时间、抢占时间、中断延迟时间、信号量混洗时间、死锁解除时间和数据吞吐时间。它们的加权和被称为RhealStone数。
>- 任务切换时间(task switching time)，也称上下文切换时间，定义为系统在两个独立的、处于就绪态并具有相同优先级的任务之间切换所需要的时间。它包括三个部分，即保存当前任务上下文的时间、调度程序选中新任务的时间和恢复新任务上下文的时间。切换所需的时间主要取决于保存任务上下文所用的数据结构以及操作系统采用的调度算法的效率。
>- 抢占时间（preemption time），即系统将控制从低优先级的任务转移到高优先级任务所花费的时间。为了对任务进行抢占，系统必须首先识别引起高优先级任务就绪的事件，比较两个任务的优先级，最后进行任务的切换，所以抢占时间中包括了任务切换时间。
>- 中断延迟时间（interrupt latency time），指从中断第一条指令所持续的时间间隔．它由四部分组成，即硬件延迟部分(通常可以忽略不计)、RTOS的关中断时间、处理器完成当前指令的时间以及中断响应周期的时间。
>- 信号量混洗时间(semaphore shuffling time)，指从一个任务释放信号量到另一个等待该信号量的任务被激活的时间延迟。在ERTOS中，通常有许多任务同时竞争某一共享资源，基于信号量的互斥访问保证了任一时刻只有一个任务能够访问公共资源。信号量混洗时间反映了与互斥有关的时间开销，因此也是衡量RTOS实时性能的一个重要指标。
>- 死锁解除时间(deadlock breaking time)，即系统解开处于死锁状态的多个任务所需花费的时间。死锁解除时间反映了RTOS解决死锁的算法的效率。
>- 数据包吞吐率(datagram throuShput time)，指一个任务通过调用RTOS的原语，把数据传送到另一个任务去时，每秒可以传送的字节数。

但是并没有针对调度算法的评估模型。而现有的关于分时操作系统调度算法的评估指标，不完全适用于实时操作系统。对于实时操作系统的算法调度，常用的评估方式是：任务错失率，即运行大量任务并调度，来计算有多少任务没有在规定时间内完成。
这种评估方式不够精细：

- 首先对于完全没有希望完成的任务来说，调度时完全可以选择放弃此任务
- 第二是不同任务的重要程度不同
- 第三是没有考虑部分完成的情况（对于不可部分完成的任务，只需要将及格线设置为100即可）

## 项目任务与难点

- 提供一套可扩展的进程调度接口
- 实现一个准确评估“任务完成度”的方案。其中一个方案是：完成度$grade=\frac{任务已运行时长}{总共需要的时长}$，这就需要一个精确计算任务执行时间的方案（参考：[评测鸭JudgeDuck-OS](#https://github.com/JudgeDuck/JudgeDuck-OS)）
- 需要一些测试数据（需要进行调研，或测试用例征集）
- 将现有的实时操作系统进程调度算法在此框架下进行测试并给出评价
- 找到一些愿意玩游戏的小朋友进行游戏，进行测试